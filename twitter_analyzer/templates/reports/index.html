{% extends "base.html" %}

{% block title %}
    {{ title }} - گزارش‌های توییتر
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/reports-style.css') }}">
{% endblock %}

{% block content %}
<div class="reports-container">
    <div class="reports-header">
        <h1>گزارش‌های تحلیلی توییتر</h1>
        {% if current_user.is_admin %}
        <button type="button" class="btn" id="generate-report-btn">
            گزارش جدید
        </button>
        {% endif %}
    </div>
    
    <div class="reports-status" id="status">
        در حال بارگذاری گزارش‌ها...
    </div>
    
    <div class="reports-content">
        <table class="reports-table" id="reports-table">
            <thead>
                <tr>
                    <th>شناسه</th>
                    <th>بازه زمانی</th>
                    <th>تاریخ ایجاد</th>
                    <th>تعداد توییت‌ها</th>
                    <th>کلمات کلیدی</th>
                    <th>عملیات</th>
                </tr>
            </thead>
            <tbody id="reports-tbody">
                <!-- گزارش‌ها اینجا نمایش داده می‌شوند -->
            </tbody>
        </table>
    </div>
</div>

<!-- مودال تولید گزارش -->
<div class="modal-overlay" id="generate-report-modal">
    <div class="modal-container">
        <div class="modal-header">
            <h5 class="modal-title">گزارش جدید</h5>
            <button type="button" class="modal-close" id="close-generate-modal">&times;</button>
        </div>
        <div class="modal-body">
            <form id="generate-report-form" class="generate-form">
                <div class="form-group">
                    <label for="period-select">بازه زمانی</label>
                    <select id="period-select" name="period">
                        <option value="minute">دقیقه گذشته</option>
                        <option value="hour" selected>ساعت گذشته</option>
                        <option value="day">روز گذشته</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="keywords-input">کلمات کلیدی (اختیاری، جدا شده با کاما)</label>
                    <input type="text" id="keywords-input" name="keywords" placeholder="کلمه۱, کلمه۲, ...">
                </div>
                <div class="form-error" id="generate-error">
                    خطا در تولید گزارش
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn" id="cancel-generate-btn">انصراف</button>
            <button type="button" class="btn btn-view" id="submit-generate-report">تولید گزارش</button>
        </div>
    </div>
</div>

<!-- مودال نمایش جزئیات گزارش -->
<div class="modal-overlay" id="report-details-modal">
    <div class="modal-container">
        <div class="modal-header">
            <h5 class="modal-title">جزئیات گزارش</h5>
            <button type="button" class="modal-close" id="close-details-modal">&times;</button>
        </div>
        <div class="modal-body">
            <div class="form-error" id="details-error">
                خطا در بارگذاری جزئیات
            </div>
            
            <!-- گزارش خلاصه -->
            <div class="report-card">
                <div class="report-card-header">
                    <h5>خلاصه</h5>
                </div>
                <div class="report-card-body">
                    <div class="report-info-list">
                        <div class="report-info-item">
                            <dt>بازه زمانی</dt>
                            <dd id="report-period"></dd>
                            
                            <dt>زمان شروع</dt>
                            <dd id="report-start-time"></dd>
                            
                            <dt>زمان پایان</dt>
                            <dd id="report-end-time"></dd>
                        </div>
                        <div class="report-info-item">
                            <dt>تعداد توییت‌ها</dt>
                            <dd id="report-total-tweets"></dd>
                            
                            <dt>مجموع لایک‌ها</dt>
                            <dd id="report-total-likes"></dd>
                            
                            <dt>مجموع ریتوییت‌ها</dt>
                            <dd id="report-total-retweets"></dd>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- تحلیل احساسات -->
            <div class="report-card">
                <div class="report-card-header">
                    <h5>تحلیل احساسات</h5>
                </div>
                <div class="report-card-body">
                    <div id="sentiment-chart" class="chart-container"></div>
                </div>
            </div>
            
            <!-- هشتگ‌ها و منشن‌ها -->
            <div class="reports-grid">
                <div class="report-card">
                    <div class="report-card-header">
                        <h5>هشتگ‌های برتر</h5>
                    </div>
                    <div class="report-card-body">
                        <ul class="report-list" id="top-hashtags"></ul>
                    </div>
                </div>
                <div class="report-card">
                    <div class="report-card-header">
                        <h5>منشن‌های برتر</h5>
                    </div>
                    <div class="report-card-body">
                        <ul class="report-list" id="top-mentions"></ul>
                    </div>
                </div>
            </div>
            
            <!-- تحلیل هوش مصنوعی -->
            <div class="report-card" id="ai-analysis-card" style="display: none;">
                <div class="report-card-header">
                    <h5>تحلیل هوش مصنوعی</h5>
                </div>
                <div class="report-card-body">
                    <pre id="ai-analysis-content" style="direction: rtl; text-align: right;"></pre>
                </div>
            </div>
            
            <!-- توییت‌های برتر -->
            <div class="report-card">
                <div class="report-card-header">
                    <h5>توییت‌های برتر</h5>
                </div>
                <div class="report-card-body">
                    <div id="top-tweets"></div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn" id="close-details-btn">بستن</button>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/reports.js') }}"></script>


{% endblock %}