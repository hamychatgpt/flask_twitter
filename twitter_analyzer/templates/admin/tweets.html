{% extends "base.html" %}

{% block title %}Ù…Ø¯ÛŒØ±ÛŒØª ØªÙˆÛŒÛŒØªâ€ŒÙ‡Ø§{% endblock %}

{% block content %}
<div class="admin-tweets-container">
    <h1>Ù…Ø¯ÛŒØ±ÛŒØª ØªÙˆÛŒÛŒØªâ€ŒÙ‡Ø§</h1>
    
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="flash-container">
                {% for category, message in messages %}
                    <div class="flash {{ category }}">{{ message }}</div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}
    
    <!-- ÙÛŒÙ„ØªØ±Ù‡Ø§ÛŒ Ø¬Ø³ØªØ¬Ùˆ -->
    <div class="admin-section search-filters">
        <h2>Ø¬Ø³ØªØ¬Ùˆ Ùˆ ÙÛŒÙ„ØªØ±</h2>
        <form method="GET" action="{{ url_for('admin.tweets') }}" class="filter-form">
            <div class="form-row">
                <div class="form-group">
                    <label for="keyword">Ú©Ù„ÛŒØ¯ÙˆØ§Ú˜Ù‡:</label>
                    <input type="text" id="keyword" name="keyword" class="form-control" value="{{ request.args.get('keyword', '') }}">
                </div>
                <div class="form-group">
                    <label for="username">Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ:</label>
                    <input type="text" id="username" name="username" class="form-control" value="{{ request.args.get('username', '') }}">
                </div>
                <div class="form-group">
                    <label for="date_from">Ø§Ø² ØªØ§Ø±ÛŒØ®:</label>
                    <input type="date" id="date_from" name="date_from" class="form-control" value="{{ request.args.get('date_from', '') }}">
                </div>
                <div class="form-group">
                    <label for="date_to">ØªØ§ ØªØ§Ø±ÛŒØ®:</label>
                    <input type="date" id="date_to" name="date_to" class="form-control" value="{{ request.args.get('date_to', '') }}">
                </div>
                <div class="form-group button-group">
                    <button type="submit" class="btn">Ø¬Ø³ØªØ¬Ùˆ</button>
                    <a href="{{ url_for('admin.tweets') }}" class="btn btn-secondary">Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙÛŒÙ„ØªØ±Ù‡Ø§</a>
                </div>
            </div>
        </form>
    </div>
    
    <!-- Ø¬Ø¯ÙˆÙ„ ØªÙˆÛŒÛŒØªâ€ŒÙ‡Ø§ -->
    <div class="admin-section">
        <h2>Ù„ÛŒØ³Øª ØªÙˆÛŒÛŒØªâ€ŒÙ‡Ø§</h2>
        <div class="table-responsive">
            <table class="tweets-table">
                <thead>
                    <tr>
                        <th>Ø´Ù†Ø§Ø³Ù‡</th>
                        <th>Ù…ØªÙ† ØªÙˆÛŒÛŒØª</th>
                        <th>Ù†ÙˆÛŒØ³Ù†Ø¯Ù‡</th>
                        <th>ØªØ§Ø±ÛŒØ®</th>
                        <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
                    </tr>
                </thead>
                <tbody>
                    {% if tweets %}
                        {% for tweet in tweets %}
                            <tr>
                                <td>{{ tweet.id }}</td>
                                <td class="tweet-text">{{ tweet.text }}</td>
                                <td>{{ tweet.username }}</td>
                                <td>{{ tweet.created }}</td>
                                <td class="tweet-actions">
                                    <button class="btn-icon view-tweet" data-tweet-id="{{ tweet.id }}" title="Ù…Ø´Ø§Ù‡Ø¯Ù‡">
                                        <span class="icon">ğŸ‘ï¸</span>
                                    </button>
                                    <button class="btn-icon delete-tweet" data-tweet-id="{{ tweet.id }}" title="Ø­Ø°Ù">
                                        <span class="icon">ğŸ—‘ï¸</span>
                                    </button>
                                </td>
                            </tr>
                        {% endfor %}
                    {% else %}
                        <tr>
                            <td colspan="5" class="text-center">Ù‡ÛŒÚ† ØªÙˆÛŒÛŒØªÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.</td>
                        </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- ØµÙØ­Ù‡â€ŒØ¨Ù†Ø¯ÛŒ -->
    {% if total_pages > 1 %}
        <div class="pagination">
            {% if page > 1 %}
                <a href="{{ url_for('admin.tweets', page=page-1, **request.args) }}" class="pagination-item">Ù‚Ø¨Ù„ÛŒ</a>
            {% endif %}
            
            {% for p in range(1, total_pages + 1) %}
                {% if p == page %}
                    <span class="pagination-item active">{{ p }}</span>
                {% elif p == 1 or p == total_pages or (p >= page - 2 and p <= page + 2) %}
                    <a href="{{ url_for('admin.tweets', page=p, **request.args) }}" class="pagination-item">{{ p }}</a>
                {% elif p == page - 3 or p == page + 3 %}
                    <span class="pagination-item dots">...</span>
                {% endif %}
            {% endfor %}
            
            {% if page < total_pages %}
                <a href="{{ url_for('admin.tweets', page=page+1, **request.args) }}" class="pagination-item">Ø¨Ø¹Ø¯ÛŒ</a>
            {% endif %}
        </div>
    {% endif %}
    
    <div class="navigation-buttons">
        <a href="{{ url_for('admin.index') }}" class="btn btn-secondary">Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª</a>
    </div>
    
    <!-- Ù…ÙˆØ¯Ø§Ù„ Ù…Ø´Ø§Ù‡Ø¯Ù‡ ØªÙˆÛŒÛŒØª -->
    <div id="tweet-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Ù…Ø´Ø§Ù‡Ø¯Ù‡ ØªÙˆÛŒÛŒØª</h2>
            <div class="tweet-details">
                <div id="tweet-modal-content">
                    <!-- Ù…Ø­ØªÙˆØ§ÛŒ ØªÙˆÛŒÛŒØª Ø§ÛŒÙ†Ø¬Ø§ Ù‚Ø±Ø§Ø± Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ø¯ -->
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ù…ÙˆØ¯Ø§Ù„
    document.addEventListener('DOMContentLoaded', function() {
        const modal = document.getElementById('tweet-modal');
        const modalContent = document.getElementById('tweet-modal-content');
        const closeBtn = document.querySelector('.close');
        
        // Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø´Ø§Ù‡Ø¯Ù‡ ØªÙˆÛŒÛŒØª
        const viewButtons = document.querySelectorAll('.view-tweet');
        viewButtons.forEach(button => {
            button.addEventListener('click', function() {
                const tweetId = this.getAttribute('data-tweet-id');
                const tweetText = this.closest('tr').querySelector('.tweet-text').textContent;
                
                // Ù†Ù…Ø§ÛŒØ´ Ù…Ø­ØªÙˆØ§ÛŒ ØªÙˆÛŒÛŒØª Ø¯Ø± Ù…ÙˆØ¯Ø§Ù„
                modalContent.innerHTML = `
                    <p><strong>Ø´Ù†Ø§Ø³Ù‡:</strong> ${tweetId}</p>
                    <p><strong>Ù…ØªÙ† ØªÙˆÛŒÛŒØª:</strong></p>
                    <p>${tweetText}</p>
                `;
                
                // Ù†Ù…Ø§ÛŒØ´ Ù…ÙˆØ¯Ø§Ù„
                modal.style.display = 'block';
            });
        });
        
        // Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø­Ø°Ù ØªÙˆÛŒÛŒØª - Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† ØªØ£ÛŒÛŒØ¯ÛŒÙ‡
        const deleteButtons = document.querySelectorAll('.delete-tweet');
        deleteButtons.forEach(button => {
            button.addEventListener('click', function() {
                const tweetId = this.getAttribute('data-tweet-id');
                if (confirm('Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† ØªÙˆÛŒÛŒØª Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ')) {
                    // Ø¯Ø± Ø§ÛŒÙ†Ø¬Ø§ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ ÛŒÚ© Ø¯Ø±Ø®ÙˆØ§Ø³Øª AJAX Ø¨Ø±Ø§ÛŒ Ø­Ø°Ù ØªÙˆÛŒÛŒØª Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯
                    alert('Ø§ÛŒÙ† Ù‚Ø§Ø¨Ù„ÛŒØª Ù‡Ù†ÙˆØ² Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.');
                }
            });
        });
        
        // Ø¨Ø³ØªÙ† Ù…ÙˆØ¯Ø§Ù„
        closeBtn.addEventListener('click', function() {
            modal.style.display = 'none';
        });
        
        // Ø¨Ø³ØªÙ† Ù…ÙˆØ¯Ø§Ù„ Ø¨Ø§ Ú©Ù„ÛŒÚ© Ø®Ø§Ø±Ø¬ Ø§Ø² Ø¢Ù†
        window.addEventListener('click', function(event) {
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        });
    });
</script>
{% endblock %}